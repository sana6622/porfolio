import{Repulse as T}from"./index-Wg1XNW-C.js";import{E as _}from"./ExternalInteractorBase-CIi3zRdK.js";import{C as M,R as q}from"./Ranges-DHqWSxiU.js";import{ae as O,a0 as b,af as w,Y as C,ap as S,C as P,D as H,a as R,ag as V,al as F}from"./index-DKFLplrH.js";const h="repulse",W=0,A=6,I=3,L=2,B=0,Y=0,j=1,x=.5;class Q extends _{constructor(c,n){super(n),this._clickRepulse=()=>{const t=this.container,i=t.actualOptions.interactivity.modes.repulse;if(!i)return;const e=t.repulse??{particles:[]};if(e.finish||(e.count||(e.count=0),e.count++,e.count===t.particles.count&&(e.finish=!0)),e.clicking){const s=t.retina.repulseModeDistance;if(!s||s<W)return;const r=Math.pow(s/A,I),u=t.interactivity.mouse.clickPosition;if(u===void 0)return;const o=new M(u.x,u.y,r),a=t.particles.quadTree.query(o,l=>this.isEnabled(l));for(const l of a){const{dx:p,dy:d,distance:m}=O(u,l.position),f=m**L,v=i.speed,k=-r*v/f;if(f<=r){e.particles.push(l);const g=b.create(p,d);g.length=k,l.velocity.setTo(g)}}}else if(e.clicking===!1){for(const s of e.particles)s.velocity.setTo(s.initialVelocity);e.particles=[]}},this._hoverRepulse=()=>{const t=this.container,i=t.interactivity.mouse.position,e=t.retina.repulseModeDistance;!e||e<B||!i||this._processRepulse(i,e,new M(i.x,i.y,e))},this._processRepulse=(t,i,e,s)=>{const r=this.container,u=r.particles.quadTree.query(e,v=>this.isEnabled(v)),o=r.actualOptions.interactivity.modes.repulse;if(!o)return;const{easing:a,speed:l,factor:p,maxSpeed:d}=o,m=w(a),f=((s==null?void 0:s.speed)??l)*p;for(const v of u){const{dx:k,dy:g,distance:y}=O(v.position,t),E=C(m(j-y/i)*f,Y,d),D=b.create(y?k/y*E:f,y?g/y*E:f);v.position.addTo(D)}},this._singleSelectorRepulse=(t,i)=>{const e=this.container,s=e.actualOptions.interactivity.modes.repulse;if(!s)return;const r=document.querySelectorAll(t);r.length&&r.forEach(u=>{const o=u,a=e.retina.pixelRatio,l={x:(o.offsetLeft+o.offsetWidth*x)*a,y:(o.offsetTop+o.offsetHeight*x)*a},p=o.offsetWidth*x*a,d=i.type==="circle"?new M(l.x,l.y,p):new q(o.offsetLeft*a,o.offsetTop*a,o.offsetWidth*a,o.offsetHeight*a),m=s.divs,f=S(m,o);this._processRepulse(l,p,d,f)})},this._engine=c,n.repulse||(n.repulse={particles:[]}),this.handleClickMode=t=>{const i=this.container.actualOptions,e=i.interactivity.modes.repulse;if(!e||t!==h)return;n.repulse||(n.repulse={particles:[]});const s=n.repulse;s.clicking=!0,s.count=0;for(const r of n.repulse.particles)this.isEnabled(r)&&r.velocity.setTo(r.initialVelocity);s.particles=[],s.finish=!1,setTimeout(()=>{n.destroyed||(s.clicking=!1)},e.duration*P)}}clear(){}init(){const c=this.container,n=c.actualOptions.interactivity.modes.repulse;n&&(c.retina.repulseModeDistance=n.distance*c.retina.pixelRatio)}interact(){const c=this.container,n=c.actualOptions,t=c.interactivity.status===H,i=n.interactivity.events,e=i.onHover,s=e.enable,r=e.mode,u=i.onClick,o=u.enable,a=u.mode,l=i.onDiv;t&&s&&R(h,r)?this._hoverRepulse():o&&R(h,a)?this._clickRepulse():V(h,l,(p,d)=>this._singleSelectorRepulse(p,d))}isEnabled(c){const n=this.container,t=n.actualOptions,i=n.interactivity.mouse,e=((c==null?void 0:c.interactivity)??t.interactivity).events,s=e.onDiv,r=e.onHover,u=e.onClick,o=F(h,s);if(!(o||r.enable&&i.position||u.enable&&i.clickPosition))return!1;const a=r.mode,l=u.mode;return R(h,a)||R(h,l)||o}loadModeOptions(c,...n){c.repulse||(c.repulse=new T);for(const t of n)c.repulse.load(t==null?void 0:t.repulse)}reset(){}}export{Q as Repulser};
